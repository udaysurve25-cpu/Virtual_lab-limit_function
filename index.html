<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Function Limit Calculator with Graph</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjs@11.6.0/lib/browser/math.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a237e 0%, #4a148c 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #303f9f 0%, #512da8 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            padding: 25px;
        }
        
        .input-section {
            flex: 1;
            min-width: 300px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 10px;
            margin-right: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .graph-section {
            flex: 2;
            min-width: 500px;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #303f9f;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #c5cae9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #303f9f;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #calculateBtn {
            background-color: #303f9f;
            color: white;
        }
        
        #calculateBtn:hover {
            background-color: #283593;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(48, 63, 159, 0.3);
        }
        
        #resetBtn {
            background-color: #f5f5f5;
            color: #555;
        }
        
        #resetBtn:hover {
            background-color: #e0e0e0;
            transform: translateY(-3px);
        }
        
        .result-box {
            margin-top: 25px;
            padding: 20px;
            background-color: #e8eaf6;
            border-radius: 8px;
            border-left: 5px solid #303f9f;
        }
        
        .result-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #303f9f;
        }
        
        #result {
            font-size: 1.2rem;
            font-family: 'Courier New', monospace;
        }
        
        #graph {
            width: 100%;
            height: 500px;
            background-color: white;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .instructions {
            margin-top: 30px;
            padding: 20px;
            background-color: #f1f8e9;
            border-radius: 10px;
            border-left: 5px solid #7cb342;
        }
        
        .instructions h3 {
            color: #558b2f;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .example-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .example-item {
            padding: 10px;
            background-color: white;
            border-radius: 6px;
            border: 1px solid #c5cae9;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }
        
        .example-item:hover {
            background-color: #e8eaf6;
            transform: translateY(-2px);
        }
        
        .function-example {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #303f9f;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #9e9e9e;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 900px) {
            .content {
                flex-direction: column;
            }
            
            .input-section {
                margin-right: 0;
            }
            
            .graph-section {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Function Limit Calculator</h1>
            <p class="subtitle">Enter a mathematical function, specify the limit point, and visualize the function graph with the limit calculation.</p>
        </header>
        
        <div class="content">
            <div class="input-section">
                <div class="input-group">
                    <label for="functionInput">Function f(x)</label>
                    <input type="text" id="functionInput" value="sin(x)/x" placeholder="e.g., sin(x)/x, x^2+2*x+1, log(x)">
                    <small>Use JavaScript math syntax: sin(x), cos(x), tan(x), log(x), sqrt(x), ^ for power</small>
                </div>
                
                <div class="input-group">
                    <label for="limitPoint">Limit Point (x → a)</label>
                    <input type="text" id="limitPoint" value="0" placeholder="Enter a number or 'inf' for infinity">
                </div>
                
                <div class="input-group">
                    <label for="direction">Direction</label>
                    <select id="direction">
                        <option value="both">Both sides (x → a)</option>
                        <option value="left">Left side only (x → a⁻)</option>
                        <option value="right">Right side only (x → a⁺)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label>Try these examples:</label>
                    <div class="example-list">
                        <div class="example-item" data-func="sin(x)/x" data-point="0">
                            <div class="function-example">sin(x)/x</div>
                            <div>as x → 0</div>
                        </div>
                        <div class="example-item" data-func="(x^2-1)/(x-1)" data-point="1">
                            <div class="function-example">(x²-1)/(x-1)</div>
                            <div>as x → 1</div>
                        </div>
                        <div class="example-item" data-func="1/x" data-point="0">
                            <div class="function-example">1/x</div>
                            <div>as x → 0</div>
                        </div>
                        <div class="example-item" data-func="log(x)" data-point="0">
                            <div class="function-example">log(x)</div>
                            <div>as x → 0⁺</div>
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button id="calculateBtn">Calculate Limit</button>
                    <button id="resetBtn">Reset</button>
                </div>
                
                <div class="result-box">
                    <div class="result-title">Limit Result:</div>
                    <div id="result">Enter a function and click "Calculate Limit"</div>
                </div>
            </div>
            
            <div class="graph-section">
                <h2>Graphical Representation</h2>
                <div id="graph"></div>
            </div>
        </div>
        
        <div class="instructions">
            <h3>How to Use This Calculator</h3>
            <ul>
                <li>Enter a mathematical function using standard JavaScript math notation.</li>
                <li>Specify the limit point (can be a number or "inf" for infinity).</li>
                <li>Select the direction (both sides, left only, or right only).</li>
                <li>Click "Calculate Limit" to compute and visualize the limit.</li>
                <li>Click on any example to quickly try it out.</li>
            </ul>
        </div>
        
        <footer>
            <p>Function Limit Calculator with Graphical Representation | Uses Math.js for calculations and Plotly for graphing</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const functionInput = document.getElementById('functionInput');
        const limitPoint = document.getElementById('limitPoint');
        const direction = document.getElementById('direction');
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const result = document.getElementById('result');
        const graph = document.getElementById('graph');
        const exampleItems = document.querySelectorAll('.example-item');
        
        // Initialize graph with empty plot
        Plotly.newPlot(graph, [{
            x: [],
            y: [],
            type: 'scatter',
            mode: 'lines',
            line: {color: '#303f9f', width: 3},
            name: 'f(x)'
        }], {
            title: 'Function Graph',
            xaxis: {title: 'x'},
            yaxis: {title: 'f(x)'},
            plot_bgcolor: '#f8f9fa',
            paper_bgcolor: '#ffffff'
        });
        
        // Calculate limit function
        async function calculateLimit() {
            const funcStr = functionInput.value.trim();
            const pointStr = limitPoint.value.trim();
            const dir = direction.value;
            
            if (!funcStr) {
                result.innerHTML = '<span style="color:red">Please enter a function</span>';
                return;
            }
            
            if (!pointStr) {
                result.innerHTML = '<span style="color:red">Please enter a limit point</span>';
                return;
            }
            
            // Show loading
            result.innerHTML = 'Calculating...';
            
            try {
                // Parse function
                const func = math.compile(funcStr);
                
                // Parse limit point
                let point;
                if (pointStr.toLowerCase() === 'inf' || pointStr === '∞') {
                    point = Infinity;
                } else if (pointStr.toLowerCase() === '-inf' || pointStr === '-∞') {
                    point = -Infinity;
                } else {
                    point = parseFloat(pointStr);
                    if (isNaN(point)) {
                        throw new Error('Invalid limit point. Must be a number or "inf".');
                    }
                }
                
                // Calculate limit numerically
                let limitValue;
                if (point === Infinity || point === -Infinity) {
                    limitValue = calculateLimitAtInfinity(func, point);
                } else {
                    limitValue = calculateLimitAtPoint(func, point, dir);
                }
                
                // Display result
                let pointDisplay = point === Infinity ? '∞' : point === -Infinity ? '-∞' : point;
                let dirSymbol = '';
                if (dir === 'left') dirSymbol = '⁻';
                if (dir === 'right') dirSymbol = '⁺';
                
                if (limitValue === undefined) {
                    result.innerHTML = `Limit does not exist as x → ${pointDisplay}${dirSymbol}`;
                } else if (limitValue === Infinity) {
                    result.innerHTML = `lim<sub>x→${pointDisplay}${dirSymbol}</sub> f(x) = ∞`;
                } else if (limitValue === -Infinity) {
                    result.innerHTML = `lim<sub>x→${pointDisplay}${dirSymbol}</sub> f(x) = -∞`;
                } else {
                    result.innerHTML = `lim<sub>x→${pointDisplay}${dirSymbol}</sub> f(x) = ${limitValue.toFixed(6)}`;
                }
                
                // Generate and plot graph
                plotFunction(func, point, dir, limitValue);
                
            } catch (error) {
                result.innerHTML = `<span style="color:red">Error: ${error.message}</span>`;
                console.error(error);
            }
        }
        
        // Calculate limit at a finite point
        function calculateLimitAtPoint(func, point, dir) {
            const epsilons = [0.1, 0.01, 0.001, 0.0001, 0.00001];
            let leftValues = [];
            let rightValues = [];
            
            // Calculate values approaching from left and right
            for (let eps of epsilons) {
                if (dir === 'both' || dir === 'left') {
                    try {
                        const x = point - eps;
                        const y = func.evaluate({x: x});
                        if (isFinite(y)) leftValues.push(y);
                    } catch (e) {
                        // Ignore evaluation errors
                    }
                }
                
                if (dir === 'both' || dir === 'right') {
                    try {
                        const x = point + eps;
                        const y = func.evaluate({x: x});
                        if (isFinite(y)) rightValues.push(y);
                    } catch (e) {
                        // Ignore evaluation errors
                    }
                }
            }
            
            // Check if limit exists
            if (dir === 'both') {
                if (leftValues.length === 0 || rightValues.length === 0) return undefined;
                
                // Check if left and right limits are approximately equal
                const leftAvg = leftValues.reduce((a, b) => a + b, 0) / leftValues.length;
                const rightAvg = rightValues.reduce((a, b) => a + b, 0) / rightValues.length;
                
                if (Math.abs(leftAvg - rightAvg) > 0.01) return undefined;
                
                return (leftAvg + rightAvg) / 2;
            } else if (dir === 'left') {
                if (leftValues.length === 0) return undefined;
                return leftValues.reduce((a, b) => a + b, 0) / leftValues.length;
            } else { // right
                if (rightValues.length === 0) return undefined;
                return rightValues.reduce((a, b) => a + b, 0) / rightValues.length;
            }
        }
        
        // Calculate limit at infinity
        function calculateLimitAtInfinity(func, infinityDir) {
            const largeNumbers = infinityDir === Infinity ? 
                [10, 100, 1000, 10000, 100000] : 
                [-10, -100, -1000, -10000, -100000];
            
            const values = [];
            
            for (let x of largeNumbers) {
                try {
                    const y = func.evaluate({x: x});
                    if (isFinite(y)) values.push(y);
                } catch (e) {
                    // Ignore evaluation errors
                }
            }
            
            if (values.length === 0) return undefined;
            
            // Check if values are approaching a finite limit or infinity
            const avg = values.reduce((a, b) => a + b, 0) / values.length;
            
            // Check if values are diverging
            const lastValue = values[values.length - 1];
            const secondLastValue = values.length > 1 ? values[values.length - 2] : lastValue;
            
            if (Math.abs(lastValue) > Math.abs(secondLastValue) * 10) {
                return lastValue > 0 ? Infinity : -Infinity;
            }
            
            return avg;
        }
        
        // Plot function graph
        function plotFunction(func, point, dir, limitValue) {
            // Determine x range based on limit point
            let xMin, xMax;
            
            if (point === Infinity) {
                xMin = 0.1;
                xMax = 20;
            } else if (point === -Infinity) {
                xMin = -20;
                xMax = -0.1;
            } else {
                const range = Math.max(5, Math.abs(point) * 2);
                xMin = point - range;
                xMax = point + range;
            }
            
            // Generate x values, avoiding discontinuities
            const step = (xMax - xMin) / 500;
            const xValues = [];
            const yValues = [];
            
            for (let x = xMin; x <= xMax; x += step) {
                // Skip exactly at the limit point if it might be undefined
                if (Math.abs(x - point) < step / 2 && point !== Infinity && point !== -Infinity) {
                    continue;
                }
                
                try {
                    const y = func.evaluate({x: x});
                    if (isFinite(y)) {
                        xValues.push(x);
                        yValues.push(y);
                    } else {
                        // Break the line at discontinuities
                        xValues.push(NaN);
                        yValues.push(NaN);
                    }
                } catch (e) {
                    // Break the line at evaluation errors
                    xValues.push(NaN);
                    yValues.push(NaN);
                }
            }
            
            // Create traces
            const traces = [{
                x: xValues,
                y: yValues,
                type: 'scatter',
                mode: 'lines',
                line: {color: '#303f9f', width: 3},
                name: 'f(x)'
            }];
            
            // Add limit point if finite
            if (isFinite(point) && point !== Infinity && point !== -Infinity) {
                // Add vertical line at limit point
                traces.push({
                    x: [point, point],
                    y: [Math.min(...yValues.filter(y => isFinite(y))), Math.max(...yValues.filter(y => isFinite(y)))],
                    type: 'scatter',
                    mode: 'lines',
                    line: {color: 'rgba(244, 67, 54, 0.7)', width: 2, dash: 'dash'},
                    name: `x = ${point}`
                });
                
                // Add limit point marker if limit exists
                if (limitValue !== undefined && isFinite(limitValue)) {
                    traces.push({
                        x: [point],
                        y: [limitValue],
                        type: 'scatter',
                        mode: 'markers',
                        marker: {color: '#f44336', size: 10},
                        name: `Limit (${limitValue.toFixed(3)})`
                    });
                }
            }
            
            // Update graph
            const layout = {
                title: `Graph of f(x) = ${functionInput.value}`,
                xaxis: {title: 'x', range: [xMin, xMax]},
                yaxis: {title: 'f(x)', autorange: true},
                plot_bgcolor: '#f8f9fa',
                paper_bgcolor: '#ffffff',
                showlegend: true,
                legend: {x: 0.02, y: 0.98}
            };
            
            Plotly.react(graph, traces, layout);
        }
        
        // Reset form
        function resetForm() {
            functionInput.value = 'sin(x)/x';
            limitPoint.value = '0';
            direction.value = 'both';
            result.innerHTML = 'Enter a function and click "Calculate Limit"';
            
            // Reset graph
            Plotly.react(graph, [{
                x: [],
                y: [],
                type: 'scatter',
                mode: 'lines',
                line: {color: '#303f9f', width: 3},
                name: 'f(x)'
            }], {
                title: 'Function Graph',
                xaxis: {title: 'x'},
                yaxis: {title: 'f(x)'},
                plot_bgcolor: '#f8f9fa',
                paper_bgcolor: '#ffffff'
            });
        }
        
        // Load example
        function loadExample(func, point) {
            functionInput.value = func;
            limitPoint.value = point;
            
            // Set direction to right for log(x) at 0
            if (func === 'log(x)' && point === '0') {
                direction.value = 'right';
            } else {
                direction.value = 'both';
            }
            
            calculateLimit();
        }
        
        // Event listeners
        calculateBtn.addEventListener('click', calculateLimit);
        resetBtn.addEventListener('click', resetForm);
        
        exampleItems.forEach(item => {
            item.addEventListener('click', () => {
                const func = item.getAttribute('data-func');
                const point = item.getAttribute('data-point');
                loadExample(func, point);
            });
        });
        
        // Calculate limit on Enter key in inputs
        functionInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') calculateLimit();
        });
        
        limitPoint.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') calculateLimit();
        });
        
        // Initialize with an example
        window.addEventListener('load', () => {
            calculateLimit();
        });
    </script>
</body>
</html>
